{#

This file is part of the Networking package.

(c) net working AG <info@networking.ch>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}
{% set last_edited = app.session.get('MenuItem.last_edited') %}
{% autoescape false %}
<script type="text/javascript">
    var pageDialog;

    function initializeDialog() {
        if (!pageDialog) {
            pageDialog = jQuery('#page_dialog');
            pageDialog.modal({
                height:'auto',
                width:650,
                show:false,
                title:'{{ 'page.title'|trans({}, admin.translationDomain) }}'
            });
            pageDialog.on('hide', function () {
                jQuery('input[type=submit]', this).off();
            });
            jQuery(document.body).append(pageDialog);
            jQuery('form', pageDialog).live('submit', submitAjaxForm);
        }
    }

    function createAjaxDialog(event) {
        event.preventDefault();
        event.stopPropagation();

        initializeDialog();

        var a = jQuery(this);
        var url = a.attr('href');
        if (!url) {
            url = a.attr('ref');
        }

        jQuery.ajax({
            url:url,
            dataType:'html',
            success:function (html) {
                // populate the popup container
                pageDialog.html(html);
                pageDialog.modal('show');
            }
        });
    }

    function submitAjaxForm(event) {
        event.preventDefault();
        event.stopPropagation();

        var form = jQuery(this);

        jQuery(form).ajaxSubmit({
            type:form.attr('method'),
            url:form.attr('action'),
            dataType:'json',
            success:function (xhr) {
                if (xhr.result == 'ok') {
                    jQuery('#pageList').load(xhr.url);
                    pageDialog.modal('hide');
                }
            },
            error:function (xhr, textStatus, errorThrown) {
                pageDialog.html(xhr.responseText);
            }
        });
    }


    (function ($) {
        var ua = navigator.userAgent,
                event = (ua.match(/iPad/i)) ? "touchstart" : "click";


        $(".actions-toggle").bind(event, function () {
            $('.row-actions').hide();
            $(this).parent().children('.row-actions').fadeToggle('fast');
            //$(this).parent().children('.row-actions').css('display', 'inline-block');
        });
        $(".actions-toggle-close").bind(event, function () {
            $(this).parent().fadeToggle('fast');
        });

        $('.show-tooltip').tooltip({placement:'bottom', delay:{ show:800, hide:100 }});


        $('.dialog-link').bind('click', createAjaxDialog);

        initializeDialog();


    })(jQuery);
</script>
{% endautoescape %}