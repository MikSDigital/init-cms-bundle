{% autoescape false %}
<script type="text/javascript">
    var translationDialog;

    function initializeTranslationDialog() {
        if (!translationDialog) {
            translationDialog = jQuery('#translation_dialog');
            translationDialog.modal({
                height:'auto',
                width:650,
                show:false
            });
            translationDialog.on('hide', function () {
                jQuery('input[type=submit]', this).off();
            });
            jQuery(document.body).append(translationDialog);
            jQuery('form', translationDialog).live('submit', submitTranslationAjaxForm);
        }
    }

    function createTranslationAjaxDialog(event) {
        event.preventDefault();
        event.stopPropagation();

        initializeTranslationDialog();

        var a = jQuery(this);
        var url = a.attr('href');
        if (!url) {
            url = a.attr('ref');
        }

        jQuery.ajax({
            url:url,
            dataType:'html',
            success:function (html) {
                // populate the popup container
                translationDialog.html(html);
                translationDialog.modal('show');
            }
        });
    }

    function submitTranslationAjaxForm(event) {
        event.preventDefault();
        event.stopPropagation();

        var form = jQuery(this);

        jQuery(form).ajaxSubmit({
            type:form.attr('method'),
            url:form.attr('action'),
            dataType:'json',
            success:function (xhr) {
                if (xhr.result == 'ok') {
                    jQuery('#translationSettings').html(xhr.html);
                    translationDialog.modal('hide');
                }
            }
        });
    }

    (function ($) {
        $('.translation-dialog-link').live('click', createTranslationAjaxDialog);

    })(jQuery);
</script>
{% endautoescape %}
