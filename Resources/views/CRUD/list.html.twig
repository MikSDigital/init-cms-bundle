{#

This file is part of the Networking package.

(c) net working AG <info@networking.ch>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}
{% extends 'NetworkingInitCmsBundle:CRUD:base_list.html.twig' %}

{% block actions %}
    {% include 'NetworkingInitCmsBundle:Core:create_button.html.twig' %}
{% endblock %}

{% block list_table %}
    {{ parent() }}
    <script>

        var listDialog;

        function initializeDialog() {
            if (!listDialog) {
                listDialog = jQuery('#list_dialog');
                listDialog.modal({
                    height:'auto',
                    width:650,
                    show:false,
                });
                listDialog.on('hide', function () {
                    jQuery('input[type=submit]', this).off();
                });
                jQuery(document.body).append(listDialog);
                jQuery('form', listDialog).live('submit', submitAjaxForm);
            }
        }

        function createAjaxDialog(event) {
            event.preventDefault();
            event.stopPropagation();

            initializeDialog();

            var a = jQuery(this);
            var url = a.attr('href');
            if (!url) {
                url = a.attr('ref');
            }

            jQuery.ajax({
                url:url,
                dataType:'html',
                success:function (html) {
                    // populate the popup container
                    listDialog.html(html);
                    listDialog.modal('show');
                }
            });
        }

        function submitAjaxForm(event) {
            event.preventDefault();
            event.stopPropagation();

            var form = jQuery(this);

            jQuery(form).ajaxSubmit({
                type:form.attr('method'),
                url:form.attr('action'),
                success:function (xhr) {
                    jQuery('#objectList').html(xhr);
                    listDialog.modal('hide');
                },
                error:function (xhr, textStatus, errorThrown) {
                    listDialog.html(xhr.responseText);
                }
            });
        }

        $(document).ready(function () {

            var ua = navigator.userAgent,
                    event = (ua.match(/iPad/i)) ? "touchstart" : "click";


            $(".actions-toggle").live('click', function () {
                $('.row-actions').hide();
                $(this).parent().children('.row-actions').fadeToggle('fast');
            });
            $(".actions-toggle-close").live('click', function () {
                $(this).parent().fadeToggle('fast');
            });
            $('.dialog-link').bind('click', createAjaxDialog);

            $('.show-tooltip').tooltip({placement:'bottom', delay:{ show:800, hide:100 }});

            $('#hidden_filters').on('show hide', function () {
                $('#filter_toggle').toggleClass('filter-close');
                $('#filter_toggle').toggleClass('filter-open');
            });
        });
    </script>
{% endblock %}
