{#

This file is part of the Sonata package.

(c) Thomas Rabaix <thomas.rabaix@sonata-project.org>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}

{% extends 'NetworkingInitCmsBundle:CRUD:base_list.html.twig' %}

{% block preview %}

    <ul class="nav nav-pills">
        <li><a><strong>{{ "label.select_context"|trans({}, 'SonataMediaBundle') }}</strong></a></li>
        {% for name, context in media_pool.contexts %}
            {% if context.providers|length == 0 %}
                {% set urlParams = {'context' : name } %}
            {% else %}
                {% set urlParams = {'context' : name, 'provider' : context.providers[0] } %}
            {% endif %}

            {% if name == persistent_parameters.context %}
                <li class="active"><a
                        href="{{ admin.generateUrl('list', urlParams) }}">{{ name|trans({}, 'SonataMediaBundle') }}</a>
                </li>
            {% else %}
                <li><a href="{{ admin.generateUrl('list', urlParams) }}">{{ name|trans({}, 'SonataMediaBundle') }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {% set providers = media_pool.getProviderNamesByContext(persistent_parameters.context) %}

        {% if providers|length > 1 %}
            <li><a><strong>{{ "label.select_provider"|trans({}, 'SonataMediaBundle') }}</strong></a></li>

            {% if not persistent_parameters.provider %}
                <li class="active"><a
                        href="{{ admin.generateUrl('list', {'context': persistent_parameters.context, 'provider': null}) }}">{{ "link.all_providers"|trans({}, 'SonataMediaBundle') }}</a>
                </li>
            {% else %}
                <li>
                    <a href="{{ admin.generateUrl('list', {'context': persistent_parameters.context, 'provider': null}) }}">{{ "link.all_providers"|trans({}, 'SonataMediaBundle') }}</a>
                </li>
            {% endif %}

            {% for provider_name in providers %}
                {% if persistent_parameters.provider == provider_name %}
                    <li class="active"><a
                            href="{{ admin.generateUrl('list', {'context': persistent_parameters.context, 'provider': provider_name}) }}">{{ provider_name|trans({}, 'SonataMediaBundle') }}</a>
                    </li>
                {% else %}
                    <li>
                        <a href="{{ admin.generateUrl('list', {'context': persistent_parameters.context, 'provider': provider_name}) }}">{{ provider_name|trans({}, 'SonataMediaBundle') }}</a>
                    </li>
                {% endif %}
            {% endfor %}
        {% endif %}
    </ul>

{% endblock %}

{% block list_filters %}
    {% if admin.datagrid.filters %}
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
                    <div class="accordion-caret"><b class="caret"></b></div>
                    {{ 'label_filters'|trans({}, 'SonataAdminBundle') }}
                </a>
            </div>
            <div id="collapseOne" class="accordion-body collapse">
                <div class="accordion-inner" style="min-height:70px;">
                    <form class="sonata-filter-form" action="{{ admin.generateUrl('list') }}" method="GET">

                        <input type="hidden" name="context" value="{{ persistent_parameters.context }}"/>
                        <input type="hidden" name="context" value="{{ persistent_parameters.context }}"/>
                        <input type="hidden" name="provider" value="{{ persistent_parameters.provider }}"/>

                        {% for filter in admin.datagrid.filters %}
                            <label class="filter {{ filter.isActive ? 'active' : 'inactive' }}"> {{ admin.trans(filter.label) }}</label>
                            {{ form_widget(form.children[filter.formName].children['type']) }}
                            {{ form_widget(form.children[filter.formName].children['value']) }}
                        {% endfor %}


                        <input type="hidden" name="filter[_page]" id="filter__page" value="1"/>

                        {% set foo = form.children['_page'].setRendered() %}
                        {{ form_rest(form) }}

                        <input type="submit" class="btn btn-primary"
                               value="{{ 'btn_filter'|trans({}, 'SonataAdminBundle') }}"/>

                        <a class="btn"
                           href="{{ admin.generateUrl('list') }}">{{ 'link_reset_filter'|trans({}, 'SonataAdminBundle') }}</a>

                    </form>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock %}